<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geolocation Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        #status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .loading {
            background-color: #fff3cd;
            color: #856404;
        }
        #coordinates {
            margin: 20px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Geolocation Tracker</h1>
    <div id="status" class="loading">Requesting location access...</div>
    <div id="coordinates"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const coordinatesDiv = document.getElementById('coordinates');

        function updateStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = type;
        }

        async function saveCoordinates(latitude, longitude) {
            const timestamp = new Date().toISOString();
            const locationEntry = `${timestamp} - Latitude: ${latitude}, Longitude: ${longitude}\n`;
            
            try {
                // Send coordinates to GitHub repository
                const response = await fetch('https://api.github.com/repos/eyad17354/Main-website/locations.txt', {
                    method: 'PUT',
                    headers: {
                        'Authorization': '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',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update locations',
                        content: btoa(locationEntry), // Base64 encode the content
                        branch: 'main'
                    })
                });

                if (response.ok) {
                    updateStatus('Location saved successfully!', 'success');
                    coordinatesDiv.textContent = `Latest Location:\nLatitude: ${latitude}\nLongitude: ${longitude}`;
                } else {
                    throw new Error('Failed to save location');
                }
            } catch (error) {
                updateStatus('Error saving location: ' + error.message, 'error');
            }
        }

        function handleLocationError(error) {
            let errorMessage = 'Error getting location: ';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += 'Location access denied';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += 'Location information unavailable';
                    break;
                case error.TIMEOUT:
                    errorMessage += 'Location request timed out';
                    break;
                default:
                    errorMessage += error.message;
            }
            updateStatus(errorMessage, 'error');
        }

        // Request location as soon as the page loads
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    saveCoordinates(latitude, longitude);
                },
                handleLocationError,
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        } else {
            updateStatus('Geolocation is not supported by your browser', 'error');
        }
    </script>
</body>
</html> 